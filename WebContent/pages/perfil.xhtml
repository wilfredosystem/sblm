<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://java.sun.com/jsp/jstl/core">

<h:head>
	<link href="../resources/css/estilo.css" rel="stylesheet"
		type="text/css" />


	<title>SBLM</title>
</h:head>
<h:body>
	<ui:composition template="./paginaMaestra.xhtml">
		<ui:define name="content">
			<div class="contenidoPrincipal_FondoPrincipal">
				<div class="contenidoPrincipal_fondoIdentificador">
					<!-- TITULO SUBCONTENIDO -->
					<div class="perfilModulo_IconoIdentificador"></div>
					<div class="contenidoPrincipal_SubContenido">
						<label class="contenidoPrincipal_lblTituloSubContenido">Administraci&oacute;n</label><br />
						<label class="contenidoPrincipal_lblSubTituloSubContenido">Perfiles</label>
					</div>
				</div>
				<div class="contenidoPrincipal_SubFondo">

					<div class="contenidoPrincipal_subFondo_IconoPerfil"></div>
					<div id="lblSubtitulo"
						class="contenidoPrincipal_subFondo_lblTitulox">Perfil</div>
					<div class="contenidoPrincipal_fondo_formulario">


						<!-- CONTENIDO -->
						<div class="administrador_paginasContenedor">
							<div class="perfil_fondo_formulario1">
								<div class="perfil_icono_step1"></div>
								<div class="btnNuevoRegistro">
									<p:commandLink
										update=":frmRegPerfil,:frmRegPerfil:dgvPerfil,:frmRegPerfil2:dgvDatos"
										actionListener="#{perfilmoduloMB.limpiarCampos}"
										style="margin-right:20px;">
										<p:graphicImage value="/resources/images/perfil/nuevo_mas.png"
											alt="Limpiar formulario" title="limpiar" />
									</p:commandLink>
								</div>

								<h:form id="frmRegPerfil">
									<p:growl id="msjderivacion" showDetail="true" sticky="false"
										life="4000" />
									<div class="filaPerfil">
										<h:outputText class="lblPerfil" value="Perfil:" />
										<p:inputText id="txtPerfil" styleClass="txtPerfil"
											value="#{perfilmoduloMB.perfil.nombreperfil}" />
									</div>
									<div class="filaDescripcion">
										<h:outputText class="lblDescripcion" value="Descripcion:" />
										<p:inputText id="txtDescripcion" styleClass="txtDescripcion"
											value="#{perfilmoduloMB.perfil.descripcionperfil}" />
									</div>
									<div class="filaEstadoPerfil">
										<h:outputText class="lblEstadoPerfil" value="Estado:" />
										<div class="cboEstadoPerfil">
											<p:selectOneMenu value="#{perfilmoduloMB.perfil.estado}"
												style="width: 190px;  font-size: 11px;">
												<f:selectItem itemLabel="Seleccione estado" />
												<f:selectItem itemLabel="Activo" itemValue="true" />
												<f:selectItem itemLabel="Inactivo" itemValue="false" />
											</p:selectOneMenu>
										</div>
									</div>
									<!-- 									</h:form> -->
									<div class="perfil_icono_step2"></div>

									<!-- <h:form id="frmRegPerfil1"> -->

									<div class="tablaPerfil">

										<p:dataTable id="dgvPerfil" var="modu"
											value="#{ (perfilmoduloMB.bandera) ? perfilmoduloMB.modulos   :  perfilmoduloMB.listapmp }"
											style="font-size: 10px;">
											<c:if test="#{!perfilmoduloMB.bandera}">
												<f:facet name="header">  
          									  Lista de modulos Creados 
        									</f:facet>
											</c:if>
											<p:column headerText="Modulo" style="width:20%">
												<h:outputText
													value="#{ (perfilmoduloMB.bandera) ? modu.nombremodulo  :  modu.nombremodulo }" />
											</p:column>

											<c:if test="#{perfilmoduloMB.bandera}">
												<p:column headerText="estado" style="width:20%;"
													rendered="true">

													<p:selectBooleanCheckbox value="#{perfilmoduloMB.miestado}">
														<p:ajax
															listener="#{perfilmoduloMB.capturarEstado(modu.idmodulo)}" />
													</p:selectBooleanCheckbox>
												</p:column>
											</c:if>
											<c:if test="#{!perfilmoduloMB.bandera}">
												<p:column headerText="estado" style="width:20%;"
													rendered="true">

													<p:selectBooleanCheckbox
														disabled="#{perfilmoduloMB.activo}" value="#{modu.estado}">
														<p:ajax
															listener="#{perfilmoduloMB.capturarEstado(modu.idmodulo)}" />
													</p:selectBooleanCheckbox>
												</p:column>
											</c:if>

											<c:if test="#{perfilmoduloMB.bandera}">
												<p:column headerText="Lectura/Escritura" style="width:60%;">
													<p:selectOneMenu style="width: 250px;"
														value="#{ perfilmoduloMB.codpermiso }">
														<f:selectItem itemLabel="Seleccione Opcion" itemValue="" />
														<f:selectItems value="#{permisoMB.permisos}" var="perm"
															itemLabel="#{perm.valcrud}" itemValue="#{perm.idpermiso}" />
														<p:ajax
															listener="#{perfilmoduloMB.capturarPermiso(modu.idmodulo)}" />
													</p:selectOneMenu>
												</p:column>
											</c:if>
											<c:if test="#{!perfilmoduloMB.bandera}">
												<p:column headerText="Lectura/Escritura" style="width:60%;">
													<p:selectOneMenu style="width: 250px;"
														disabled="#{perfilmoduloMB.activo}"
														value="#{modu.idpermiso}">
														<f:selectItem itemLabel="Seleccione Opcion" itemValue="" />
														<f:selectItems value="#{permisoMB.permisos}" var="perm"
															itemLabel="#{perm.valcrud}" itemValue="#{perm.idpermiso}" />
														<p:ajax
															listener="#{perfilmoduloMB.capturarPermiso(modu.idmodulo)}" />

													</p:selectOneMenu>
												</p:column>
											</c:if>
										</p:dataTable>

									</div>
									<div class="tablaPerfilActualizar">

										<p:dataTable id="dgvPerfilActualizar" var="modu"
											rendered="#{perfilmoduloMB.activoperfil}"
											value="#{ perfilmoduloMB.modulos}" style="font-size: 10px;">

											<f:facet name="header">  
          									 Nueva  Lista de modulos a actualizar 
        									</f:facet>

											<p:column headerText="Modulo" style="width:20%">
												<h:outputText value="#{modu.nombremodulo}" />
											</p:column>
											<p:column headerText="estado" style="width:20%;">

												<p:selectBooleanCheckbox value="#{perfilmoduloMB.miestado}">
													<p:ajax
														listener="#{perfilmoduloMB.capturarEstado(modu.idmodulo)}" />
												</p:selectBooleanCheckbox>
											</p:column>
											<p:column headerText="Lectura/Escritura" style="width:60%;">
												<p:selectOneMenu style="width: 250px;"
													value="#{ perfilmoduloMB.codpermiso }">
													<f:selectItem itemLabel="Seleccione Opcion" itemValue="0" />
													<f:selectItems value="#{permisoMB.permisos}" var="perm"
														itemLabel="#{perm.valcrud}" itemValue="#{perm.idpermiso}" />
													<p:ajax
														listener="#{perfilmoduloMB.capturarPermiso(modu.idmodulo)}" />
												</p:selectOneMenu>
											</p:column>

										</p:dataTable>
									</div>
									<div class="perfil_fondoGuardar">
										<p:commandButton
											action="#{perfilmoduloMB.registrarPerfilModulo}"
											title="guardar" value="Guardar" style="font-size: 11px;"
											update=":frmRegPerfil2:dgvDatos, :frmRegPerfil">

										</p:commandButton>
									</div>

								</h:form>

								<div class="tablaPerfil2">
									<h:form id="frmRegPerfil2">
										<p:dataTable id="dgvDatos" var="perfmod"
											value="#{perfilmoduloMB.perfiles}"
											rowKey="#{perfmod.idperfil}"
											selection="#{perfilmoduloMB.perfil}" selectionMode="single"
											style=" width:435px; font-size: 10px;">
											<p:ajax event="rowSelect"
												listener="#{perfilmoduloMB.onRowSelect}"
												update=":frmRegPerfil, :frmRegPerfil:dgvPerfil, :frmRegPerfil:dgvPerfilActualizar" />
											<p:column headerText="Perfil"
												style="width:250px;text-align: center;">
												<h:outputText value="#{perfmod.nombreperfil}" />
											</p:column>
											<p:column headerText="Usuario Creador"
												style="text-align: center;">
												<h:outputText value="#{perfmod.descripcionperfil}" />
											</p:column>
											<p:column headerText="Estado" style="text-align: center;">
												<h:outputText
													value="#{(perfmod.estado) ? 'Activo' : 'Inactivo'}" />
											</p:column>
										</p:dataTable>

									</h:form>
								</div>

							</div>

							<div class="perfil_fondo_formulario2">
								<div class="perfil_icono_informacion"></div>

								<div class="filaNumerox">

									<div class="lblCantidadx">
										<h:outputText value=" #{moduloMB.numModulos}" />
									</div>
									<div class="lblNumerox">
										<h:outputText value=" Perfiles creados" />
									</div>
								</div>

								<div class="filaUltimox">
									<div class="lblUltimoDescripcionx">
										<h:outputText value="&Uacute;ltimo Perfil creado" />
									</div>
									<div class="lblUltimoDetallex">
										<h:outputText value="#{moduloMB.ultimoModulo}" />
									</div>
								</div>
							</div>


						</div>

					</div>
				</div>
			</div>

		</ui:define>
	</ui:composition>
</h:body>
</html>